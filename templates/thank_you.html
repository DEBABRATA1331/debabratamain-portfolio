{% extends 'base.html' %}
{% block title %}Thank You{% endblock %}
{% block content %}

<div class="container text-center mt-5" data-aos="zoom-in">
  <h2 class="fw-bold neon-glow" id="glowTitle">üéâ Thank You for Reaching Out!</h2>
  <p class="lead">I'll get back to you soon. Meanwhile ‚Äî test your skills and have fun! üéÆ</p>

  {% with messages = get_flashed_messages() %}
  {% if messages %}
  <div class="alert alert-success mt-3">{{ messages[0] }}</div>
  {% endif %}
  {% endwith %}

  <p class="glow-yellow mt-4 fst-italic">‚ÄúInnovation distinguishes between a leader and a follower.‚Äù ‚Äî Steve Jobs</p>

  <!-- ‚ö° Reflex Challenge: Moving Target -->
  <div class="my-5 text-center">
    <h4 class="neon-text">Reflex Challenge ‚ö°</h4>
    <p class="glow-yellow">Click the moving blue circle as fast as you can!</p>
    <div id="reflexContainer" class="relative mx-auto mt-4" style="width:300px; height:300px; background:#111; border:2px solid #00f7ff; border-radius:15px;">
      <div id="target" class="absolute rounded-full bg-nblue" style="width:50px; height:50px; top:125px; left:125px; cursor:pointer;"></div>
    </div>
    <p class="mt-3" id="reflexResult"></p>
  </div>

  <!-- üèì Pong Game -->
  <div class="my-5">
    <h4 class="neon-text">Pong Challenge üèì</h4>
    <p class="text-sm text-gray-400">Use your mouse or touch/swipe to move your paddle! Time Limit: 2:00</p>

    <!-- Start Button -->
    <div class="text-center my-3">
      <button id="startPong" class="btn neon-btn">Start Pong Game</button>
    </div>

    <div class="ratio ratio-16x9">
      <canvas id="pong" style="border: 2px solid #00f7ff; border-radius: 10px; width: 100%; height: 100%;"></canvas>
    </div>

    <p id="pongMessage" class="mt-3 neon-text text-lg font-bold hidden"></p>
  </div>

  <!-- üîô Back to Home -->
  <div class="mt-5">
    <a href="{{ url_for('home') }}" class="btn neon-btn w-100 w-md-auto m-2">üè† Back to Home</a>
  </div>
</div>

<!-- üéâ Confetti -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
window.onload = () => {
  confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } });
  setupPongCanvas(); // setup pong layout
};
</script>

<!-- ‚ö° Reflex Challenge Script -->
<script>
const target = document.getElementById("target");
const container = document.getElementById("reflexContainer");
const result = document.getElementById("reflexResult");

let startTime, timerId;

function moveTarget() {
  const maxX = container.clientWidth - target.clientWidth;
  const maxY = container.clientHeight - target.clientHeight;
  const x = Math.random() * maxX;
  const y = Math.random() * maxY;
  target.style.left = `${x}px`;
  target.style.top = `${y}px`;
  startTime = new Date().getTime();
}

function startReflexGame() {
  result.textContent = "";
  moveTarget();
  timerId = setInterval(moveTarget, 2000); // moves every 2 seconds
}

target.addEventListener("click", () => {
  if (!startTime) return;
  const reactionTime = new Date().getTime() - startTime;
  result.innerHTML = `‚ö° Reaction Time: <strong>${reactionTime} ms</strong>`;
  moveTarget(); // immediately move target after click
});

startReflexGame();
</script>

<!-- üéÆ Pong Game Script -->
<script>
let paddleWidth, paddleHeight, ballRadius;
let playerY, aiY, ballX, ballY;
let ballSpeedX, ballSpeedY;
let playerScore = 0;
let aiScore = 0;

const gameDuration = 120; // 2 min
let timeLeft = gameDuration;
let gameInterval = null;
let animationFrameId = null;
let gameIsRunning = false;

let canvas = null;
let ctx = null;

function setupPongCanvas() {
  canvas = document.getElementById("pong");
  ctx = canvas.getContext("2d");
  const container = canvas.parentElement;
  canvas.width = container.clientWidth;
  canvas.height = canvas.width * 0.75;
  resetGameParameters();
  renderPong();
}

window.addEventListener("resize", setupPongCanvas);

function resetGameParameters() {
  paddleWidth = canvas.width * 0.015;
  paddleHeight = canvas.height * 0.15;
  ballRadius = canvas.width * 0.01;
  playerY = canvas.height / 2 - paddleHeight / 2;
  aiY = playerY;
  ballX = canvas.width / 2;
  ballY = canvas.height / 2;
  ballSpeedX = canvas.width / 150;
  ballSpeedY = canvas.height / 150;
  if (ballSpeedX < 2) ballSpeedX = 2;
  if (ballSpeedY < 2) ballSpeedY = 2;
}

function drawRect(x, y, w, h, color) {
  ctx.fillStyle = color;
  ctx.fillRect(x, y, w, h);
}

function drawCircle(x, y, r, color) {
  ctx.fillStyle = color;
  ctx.beginPath();
  ctx.arc(x, y, r, 0, Math.PI * 2);
  ctx.fill();
}

function drawText(txt, x, y, color) {
  ctx.fillStyle = color;
  ctx.font = `${canvas.width * 0.03}px 'Inter', monospace`;
  ctx.fillText(txt, x, y);
}

function formatTime(seconds) {
  const minutes = Math.floor(seconds / 60);
  const remainingSeconds = seconds % 60;
  return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
}

function drawTimer() {
  ctx.fillStyle = "#ffeb3b";
  ctx.font = `${canvas.width * 0.04}px 'Inter', monospace`;
  ctx.textAlign = "center";
  ctx.fillText(formatTime(timeLeft), canvas.width / 2, canvas.height * 0.1);
  ctx.textAlign = "start";
}

function renderPong() {
  drawRect(0, 0, canvas.width, canvas.height, "#111");
  for (let i = 0; i < canvas.height; i += 40)
    drawRect(canvas.width / 2 - 1, i, 2, 20, "#333");
  drawRect(0, playerY, paddleWidth, paddleHeight, "#00f7ff");
  drawRect(canvas.width - paddleWidth, aiY, paddleWidth, paddleHeight, "#00f7ff");
  if (gameIsRunning) drawCircle(ballX, ballY, ballRadius, "#fff");
  drawText(playerScore, canvas.width / 4, 25, "#00f7ff");
  drawText(aiScore, canvas.width * 3 / 4 - 30, 25, "#00f7ff");
  drawTimer();
}

function resetBall(servingPlayer) {
  ballX = canvas.width / 2;
  ballY = canvas.height / 2;
  ballSpeedX = (servingPlayer === 'ai') ? -Math.abs(ballSpeedX) : Math.abs(ballSpeedX);
  ballSpeedY = (Math.random() * 2 - 1) * 3;
}

function moveBall() {
  if (!gameIsRunning) return;
  ballX += ballSpeedX;
  ballY += ballSpeedY;
  if (ballY + ballRadius > canvas.height || ballY - ballRadius < 0) ballSpeedY *= -1;

  if (ballX - ballRadius < paddleWidth && ballY > playerY && ballY < playerY + paddleHeight) {
    ballSpeedX *= -1;
    ballSpeedY = (ballY - (playerY + paddleHeight / 2)) * 0.1;
  }

  if (ballX + ballRadius > canvas.width - paddleWidth && ballY > aiY && ballY < aiY + paddleHeight) {
    ballSpeedX *= -1;
    ballSpeedY = (ballY - (aiY + paddleHeight / 2)) * 0.1;
  }

  if (ballX < 0) { aiScore++; resetBall('ai'); }
  else if (ballX > canvas.width) { playerScore++; resetBall('player'); }

  aiY += (ballY - (aiY + paddleHeight / 2)) * 0.05;
  aiY = Math.max(0, Math.min(canvas.height - paddleHeight, aiY));
}

function updatePlayerPos(y) {
  if (!gameIsRunning) return;
  const rect = canvas.getBoundingClientRect();
  playerY = Math.max(0, Math.min(canvas.height - paddleHeight, y - rect.top - paddleHeight / 2));
}

document.addEventListener("mousemove", e => updatePlayerPos(e.clientY));
document.addEventListener("touchmove", e => {
  e.preventDefault();
  updatePlayerPos(e.touches[0].clientY);
}, { passive: false });

function startTimer() {
  timeLeft = gameDuration;
  gameInterval = setInterval(() => {
    if (timeLeft > 0) timeLeft--;
    else endGame();
  }, 1000);
}

function startPongGame() {
  if (gameIsRunning) return;
  playerScore = 0;
  aiScore = 0;
  timeLeft = gameDuration;
  document.getElementById('pongMessage').classList.add('hidden');
  document.getElementById('startPong').disabled = true;
  gameIsRunning = true;
  resetBall('player');
  startTimer();
  pongLoop();
}

function endGame() {
  gameIsRunning = false;
  clearInterval(gameInterval);
  cancelAnimationFrame(animationFrameId);
  const msg = document.getElementById('pongMessage');
  msg.classList.remove('hidden');
  let text = `Game Over! Final Score ‚Äî You: ${playerScore}, AI: ${aiScore}. `;
  if (playerScore > aiScore) text += "üéâ You Win!";
  else if (aiScore > playerScore) text += "ü§ñ AI Wins!";
  else text += "It's a Tie!";
  msg.textContent = text;
  document.getElementById('startPong').disabled = false;
}

function pongLoop() {
  moveBall();
  renderPong();
  if (gameIsRunning) animationFrameId = requestAnimationFrame(pongLoop);
}

document.getElementById("startPong").addEventListener("click", startPongGame);
</script>

<!-- üí´ Neon Styles -->
<style>
.neon-glow {
  color: #ffeb3b;
  text-shadow: 0 0 5px #ffeb3b, 0 0 15px #ffeb3b, 0 0 30px #ffeb3b;
  animation: pulse 2s infinite ease-in-out;
}
@keyframes pulse {
  0% { text-shadow: 0 0 5px #ffeb3b; }
  50% { text-shadow: 0 0 15px #ffeb3b, 0 0 25px #ffeb3b; }
  100% { text-shadow: 0 0 5px #ffeb3b; }
}
.glow-yellow { color: #ffeb3b; text-shadow: 0 0 5px #ffeb3b, 0 0 15px #ffeb3b; }
.neon-text { color: #00f7ff; text-shadow: 0 0 5px #00f7ff; }

.btn.neon-btn {
  background: transparent;
  color: #00f7ff;
  border: 2px solid #00f7ff;
  box-shadow: 0 0 10px #00f7ff;
  transition: all 0.3s;
}
.btn.neon-btn:hover {
  background: #00f7ff;
  color: #111;
  box-shadow: 0 0 20px #00f7ff;
}

.bg-nblue { background-color: #00f7ff; }

@media (max-width: 576px) {
  .neon-glow { font-size: 1.4rem; }
  .ratio-16x9 { height: 200px !important; }
  .btn { font-size: 1rem; }
}
</style>

{% endblock %}
